general:
  branches:
    ignore:
      - gh\-pages
      - /pull\/.*/

machine:
  services:
    - docker
  environment:
    GOPATH: /home/ubuntu:$GOPATH
    SRCDIR: /home/ubuntu/src/github.com/weaveworks/weave
    PATH: $PATH:$HOME/.local/bin:$HOME/google-cloud-sdk/bin/
    CLOUDSDK_CORE_DISABLE_PROMPTS: 1

dependencies:
  cache_directories:
    - "~/docker"
  post:
    - bin/circle-dependencies-post

test:
  pre:
    - "$SRCDIR/bin/circle-test-pre":
        parallel: true
  override:
    - "$SRCDIR/bin/circle-test-override":
        parallel: true
        timeout: 300
  post:
    - "$SRCDIR/bin/circle-test-post":
        parallel: true

teardown:
  pre:
    - "$SRCDIR/bin/circle-teardown-pre":
        parallel: true

deployment:
  release:
    branch: /[0-9]+\.[0-9]+/
    owner: weaveworks
    commands:
      - "$SRCDIR/bin/circle-deploy-release"
  master:
    branch: master
    owner: weaveworks
    commands:
      - "$SRCDIR/bin/circle-deploy-master"
  issues:
    branch: /.*/
    owner: weaveworks
    commands:
      - "$SRCDIR/bin/circle-deploy-issues"
